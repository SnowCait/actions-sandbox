name: php/pecl-math-stats

on:
  push:
    paths:
      - .github/workflows/php-pecl-math-stats.yml

jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
    - uses: actions/checkout@v2
      with:
        repository: php/pecl-math-stats
#         ref: 2.0.3
    - run: git log -5
    - run: ls -la

    - run: phpize --version
    - run: phpize --help

    - run: phpize
    - name: diff
      run: |
        git add -N .
        git diff --name-only

    - run: pwd
    - run: mkdir -p ~/output
    - run: ./configure --help
    - run: ./configure --prefix=$(pwd)/output # 反映されない？
    - name: diff
      run: |
        git add -N .
        git diff --name-only
    - run: cat Makefile
    - run: sed -e 's|prefix = /usr|prefix = /home/runner/work/actions-sandbox/actions-sandbox/output|' Makefile
    - run: sed -i -e 's|prefix = /usr|prefix = /home/runner/work/actions-sandbox/actions-sandbox/output|' Makefile
    - run: cat Makefile

    - run: make
    - name: diff
      run: |
        git add -N .
        git diff --name-only

    - run: make install
    - name: diff
      run: |
        git add -N .
        git diff --name-only
